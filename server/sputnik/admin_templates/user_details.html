{% extends "base.html" %}
{% block title %}{{user.username}}{% endblock %}
{% block panel_title %}{{user.username}}{% endblock %}
{% block panel_body %}
{% block nav_tabs %}
{% include "navtabs.html" %}
{% endblock %}

<table id="user_info" class="table table-striped table-hover">
    <tbody>
        <tr>
            <td>Username</td>
            <td>{{user.username}}</td>
        </tr>
        <tr>
            <td>Nickname</td>
            <td>{{user.nickname}}</td>
        </tr>
        <tr>
            <td>Email</td>
            <!-- TODO: CHange this to connecto to zendesk to contact user -->
            <td><a href="mailto:{{user.email}}">{{user.email}}</a></td>
        </tr>
        <tr>
            <td>Password Reset</td>
            <td>
                <form action="/reset_password" method="post">
                    <input type="text" name="new_password">
                    <input type="hidden" name="username" value="{{user.username}}">
                </form>
            </td>
        </tr>
    </tbody>
</table>

<table id="positions" class="table table-striped table-hover">
    <thead>
        <tr>
            <th>Contract</th>
            <th>Position</th>
            <th>Reference Price</th>
            <th>Adjust</th>
        </tr>
    </thead>
    <tbody>
        {% for position in user.positions %}
        <tr>
            <td>{{position.contract.ticker}}</td>
            <td>{{position.position}}</td>
            <td>{{position.reference_price}}</td>
            {% if debug %}
            <td>
                <form action="/adjust_position" method="post">
                    <input type="text" name="adjustment">
                    <input type="hidden" name="username" value="{{user.username}}">
                    <input type="hidden" name="contract" value="{{position.contract.ticker}}">
                </form>
            </td>
            {% endif %}
        </tr>
        {% endfor %}
    </tbody>
</table>

<table id="orders" class="table table-striped table-hover">
    {% for order in user.orders %}
    <tr>
        <td>{{order.contract.ticker}}</td>
        <td>{{order.quantity}}</td>
        <td>{{order.quantity_left}}</td>
        <td>{{order.price}}</td>
        <td>{{order.side}}</td>
        <td>{{order.timestamp}}</td>
        <td>{{order.is_cancelled}}</td>
        <td>{{order.accepted}}</td>
    </tr>
        <tr>
            <th>TRADES</th>
            <th></th>
            <th></th>
            <th>Quantity</th>
            <th>Price</th>
            <th>Timestamp</th>
        </tr>
        {% for trade in order.aggressive_trades %}
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td>{{trade.quantity}}</td>
            <td>{{trade.price}}</td>
            <td>{{trade.timestamp}}</td>
        </tr>
        {% endfor %}
        {% for trade in order.passive_trades %}
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td>{{trade.quantity}}</td>
            <td>{{trade.price}}</td>
            <td>{{trade.timestamp}}</td>
        </tr>
        {% endfor %}
    {% endfor %}
</table>

<table id="addresses" class="table table-striped table-hover">
    <thead>
        <tr>
            <th>Currency</th>
            <th>Address</th>
            <th>Active</th>
            <th>Accounted For</th>
        </tr>
    </thead>
    <tbody>
        {% for address in user.addresses %}
        <tr>
            <td>{{address.currency}}</td>
            <td>{{address.address}}</td>
            <td>{{address.active}}</td>
            <td>{{address.accounted_for}}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<table id="withdrawals" class="table table-striped table-hover">
    <thead>
        <tr>
            <th>Currency</th>
            <th>Address</th>
            <th>Amount</th>
            <th>Pending</th>
            <th>Entered</th>
            <th>Completed</th>
        </tr>
    </thead>
    <tbody>
        {% for withdrawal in user.withdrawals %}
        <tr>
            <td>{{withdrawal.currency.ticker}}</td>
            <td>{{withdrawal.address}}</td>
            <td>{{withdrawal.amount}}</td>
            <td>{{withdrawal.pending}}</td>
            <td>{{withdrawal.entered}}</td>
            <td>{{withdrawal.completed}}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}